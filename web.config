# Gzip (optional)
    gzip on;
    gzip_types text/plain text/css application/json application/javascript application/xml application/xml+rss application/xhtml+xml image/svg+xml;
    gzip_min_length 1024;
 
    # Upstream to Node.js API
    upstream node_api {
        server 127.0.0.1:5003 max_fails=3 fail_timeout=10s;
        # Add more 'server' lines if you scale API instances
    }
 
    # -----------------------------
    # HTTP: redirect to HTTPS + ACME
    # -----------------------------
    server {
        listen      80;
        server_name uat.lock-india.com;
 
        # Allow HTTP-01 challenge if you use Let's Encrypt/win-acme with webroot
        location /.well-known/acme-challenge/ {
            root C:/nginx/html;
            try_files $uri =404;
        }
 
        # Everything else â†’ HTTPS
        location / {
            return 301 https://$host$request_uri;
        }
    }
 
    # -----------------------------
    # HTTPS: primary server
    # -----------------------------
    server {
        listen              443 ssl;
        server_name         uat.lock-india.com;
 
        # --- TLS certificate files ---
        ssl_certificate     C:/nginx/certs/uat.lock-india.com/fullchain.crt;
        ssl_certificate_key C:/nginx/certs/uat.lock-india.com/privkey.key;
 
        # TLS settings
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
 
        # HSTS (enable after HTTPS confirmed stable)
        # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
 
        # React build root
        root  C:/nginx/html;
        index index.html;
 
        # Static assets (cache)
        location /static/ {
            try_files $uri =404;
            access_log off;
            expires 30d;
        }
 
        # SPA routing: serve index.html for non-file paths
        location / {
            try_files $uri /index.html;
        }
 
        # Reverse proxy API to Node
        location /api/ {
            proxy_pass         http://node_api/;
            proxy_http_version 1.1;
 
            # WebSocket support
            proxy_set_header   Upgrade $http_upgrade;
            proxy_set_header   Connection "upgrade";
 
            # Forwarded headers
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Proto $scheme;
 
            # Timeouts (tune as needed)
            proxy_connect_timeout 60s;
            proxy_send_timeout    60s;
            proxy_read_timeout    60s;
 
            # Buffering
            proxy_buffering on;
            proxy_buffers 16 16k;
            proxy_buffer_size 16k;
        }
 
        # Optional: simple health endpoint
        location = /healthz {
            default_type application/json;
            return 200 '{"status":"ok"}';
        }
    }
